<!DOCTYPE html>
<!--suppress HtmlUnknownTarget -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GameTrack - Social Network for Gamers</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Custom CSS -->
  <style>
    /* ... [existing styles] ... */
    body {
      background-color: #f8f9fa;
      background-image: url("Paint.jpg");
    }

    .container {
      margin-top: 50px;
    }

    .chat-container {
      border: 1px solid #ccc;
      background-color: #fff;
      height: 400px;
      overflow-y: scroll;
      padding: 10px;
      border-radius: 5px;
    }

    .message {
      margin-bottom: 10px;
    }

    .message p {
      margin: 5px 0;
      padding: 5px 10px;
      border-radius: 10px;
    }

    .message p:nth-child(odd) {
      background-color: #e2f3ff;
    }

    .message p:nth-child(even) {
      background-color: #d4edda;
    }

    .announcement {
      margin-bottom: 20px;
      background-color: #f8d7da;
      border-color: #f5c6cb;
    }

    .navbar {
      background-color: #4267B2;
    }

    .navbar-brand {
      color: #ffffff;
      font-weight: bold;
      font-size: 24px;
    }

    .navbar-text {
      color: #ffffff;
      font-weight: bold;
    }
  </style>
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href="#">Gamer Network</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav ml-auto">
      <li class="nav-item active">
        <a class="nav-link" href="About us.html">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="UserProfile.html">Profile</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="Pairing Form.html" onclick="changeNavbarColor(event)">Pairing</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="Search Bar.html" onclick="changeNavbarColor(event)">Search</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="UserPost.html" onclick="changeNavbarColor(event)">Posts</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="Message.html" onclick="changeNavbarColor(event)">Messages</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="Contact Us.html" onclick="changeNavbarColor(event)">Request</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="Notifcation.html" onclick="changeNavbarColor(event)">Notifications</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="Friendship.html" onclick="changeNavbarColor(event)">Friendship</a>
      </li>
      <li class="nav-item ml-2">
        <a class="nav-link" href="Login In.html">Logout</a>
      </li>
    </ul>
  </div>
</nav>
<div class="container mt-5 pt-5">
  <div class="row">
    <div class="col-md-8">
      <h2 class="mb-4">Message Chat</h2>
      <div class="chat-container" id="chatContainer">
        <!-- Message container - messages will be dynamically added here -->
      </div>
      <!-- Message input form -->
      <form id="messageForm" class="mt-3">
        <div class="input-group">
          <input type="text" class="form-control" id="messageInput" placeholder="Type your message...">
          <div class="input-group-append">
            <button type="submit" class="btn btn-primary">Send</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <p></p>
  <p></p>
  <p></p>

    <div class="col-md-4">
      <h2 class="mb-4">Announcements</h2>
      <div id="announcementContainer">
        <!-- Announcements will be dynamically added here -->
      </div>
    </div>
  </div>


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Firebase JavaScript SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.5/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.5/firebase-database.js"></script>

<script>
  // Initialize Firebase
  var firebaseConfig = {
    apiKey: "AIzaSyD18a6bP6Ec0QCsLm5bl04prN_WAchA4Is",
    authDomain: "gamtrack-3a2f2.firebaseapp.com",
    projectId: "gamtrack-3a2f2",
    storageBucket: "gamtrack-3a2f2.appspot.com",
    messagingSenderId: "492662811532",
    appId: "1:492662811532:web:4e59f354ffbc43eee384a9",
    measurementId: "G-5VTT1HQLJ1"
  };
  firebase.initializeApp(firebaseConfig);

  // Authentication check
  firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
      console.log('User is signed in.');
      // User is signed in, you can handle the logic here.
    } else {
      console.log('No user is signed in.');
      // No user is signed in, handle logic such as redirecting to login page.
    }
  });

  // Function to fetch and display announcements
  function fetchAndDisplayAnnouncements() {
    var announcementContainer = document.getElementById('announcementContainer');
    var announcementsRef = firebase.database().ref('Announcement');
    announcementsRef.on('value', function(snapshot) {
      announcementContainer.innerHTML = '';  // Clear existing announcements
      snapshot.forEach(function(childSnapshot) {
        var announcement = childSnapshot.val();
        var announcementCard = document.createElement('div');
        announcementCard.className = 'card mb-3 announcement';
        announcementCard.innerHTML = `
            <div class="card-body">
              <h5 class="card-title">${announcement.title}</h5>
              <p class="card-text">${announcement.content}</p>
              <p class="text-muted"><small>Posted on: ${new Date(announcement.timestamp).toLocaleString()}</small></p>
            </div>
          `;
        announcementContainer.prepend(announcementCard);
      });
    });
  }
  fetchAndDisplayAnnouncements();

  // Function to send a message
  // Function to send a message
  document.getElementById('messageForm').addEventListener('submit', function(event) {
    event.preventDefault();
    sendMessage();
  });

  // Function to send a message
  function sendMessage() {
    var currentUser = firebase.auth().currentUser;
    if (currentUser) {
      var messageInput = document.getElementById('messageInput');
      var messageContent = messageInput.value.trim();
      if (messageContent) {
        // Generate a new message reference with an auto-generated ID
        var newMessageRef = firebase.database().ref('DirectMessage').push();
        var newMessage = {
          content: messageContent,
          createdAt: firebase.database.ServerValue.TIMESTAMP, // Firebase server timestamp
          messageId: newMessageRef.key, // Unique key for the message
          receiverId: 'REPLACE_WITH_RECEIVER_UID', // Placeholder - replace with actual logic to determine the receiver's ID
          senderId: currentUser.uid
        };

        // Push the new message to Firebase and clear the input
        newMessageRef.set(newMessage).then(() => {
          displayMessage(newMessage);
          messageInput.value = ''; // Clear the message input
        }).catch((error) => {
          console.error('Error sending message:', error);
        });
      }
    } else {
      console.error('No user is signed in to send a message.');
      // Handle the sign-in state appropriately (e.g., show a login link or modal)
    }
  }

  // Function to display a message
  function displayMessage(message) {
    var chatContainer = document.getElementById('chatContainer');
    var messageElement = document.createElement('div');
    messageElement.className = 'message';
    messageElement.innerHTML = `<p>${message.senderId === firebase.auth().currentUser.uid ? '<strong>You:</strong>' : '<strong>Other:</strong>'} ${message.content}</p>`;
    chatContainer.appendChild(messageElement);
    chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom of the chat container
  }

  // Listen for new messages
  firebase.database().ref('DirectMessage').on('child_added', function(snapshot) {
    var message = snapshot.val();
    displayMessage(message);
  });
</script>
</body>
</html>
