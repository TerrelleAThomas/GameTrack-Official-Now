<!DOCTYPE html>
<!--suppress HtmlUnknownTarget -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friendship Page</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            background-image: url('buddy.jpg');
            padding-top: 50px;
        }
        .friend-card {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h2{
            color: #ffffff;
            font-weight: bold;
        }
    </style>
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <a class="navbar-brand" href="#">Gamer Network</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
                <a class="nav-link" href="About us.html">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="UserProfile.html">Profile</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="Pairing Form.html" onclick="changeNavbarColor(event)">Pairing</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="Search Bar.html" onclick="changeNavbarColor(event)">Search</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="UserPost.html" onclick="changeNavbarColor(event)">Posts</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="Message.html" onclick="changeNavbarColor(event)">Messages</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="Chat.html" onclick="changeNavbarColor(event)">Request</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="Friendship.html" onclick="changeNavbarColor(event)">Friendship</a>
            </li>
            <li class="nav-item ml-2">
                <a class="nav-link" href="Login In.html">Logout</a>
            </li>
        </ul>
    </div>
</nav>

<p></p>
<p></p>
<!-- Friendship Page Title -->
<div class="container mt-5 mb-4">
    <h2 class="mb-4 text-center">Friendship Page</h2>
    <div class="row justify-content-center">
        <!-- User 1 Card -->
        <div class="col-xs-12 col-md-3 mb-4">
            <div class="card friend-card">
                <img src="https://via.placeholder.com/150" class="card-img-top" alt="User 1">
                <div class="card-body text-center">
                    <h5 class="card-title">User 1</h5>
                    <p class="card-text">Brief description for User 1.</p>
                    <button type="button" class="btn btn-primary btn-sm btn-rounded" onclick="makeRequest('USER1_ID')">Make a Request</button>
                    <button type="button" class="btn btn-success btn-sm btn-rounded" onclick="acceptRequest('FRIEND_REQUEST_ID_FOR_USER1')">Accept</button>
                    <button type="button" class="btn btn-danger btn-sm btn-rounded" onclick="denyRequest('FRIEND_REQUEST_ID_FOR_USER1')">Deny</button>
                </div>
            </div>
        </div>

        <!-- User 2 Card -->
        <div class="col-xs-12 col-md-3 mb-4">
            <div class="card friend-card">
                <img src="https://via.placeholder.com/150" class="card-img-top" alt="User 2">
                <div class="card-body text-center">
                    <h5 class="card-title">User 2</h5>
                    <p class="card-text">Brief description for User 2.</p>
                    <button type="button" class="btn btn-primary btn-sm btn-rounded" onclick="makeRequest('USER2_ID')">Make a Request</button>
                    <button type="button" class="btn btn-success btn-sm btn-rounded" onclick="acceptRequest('FRIEND_REQUEST_ID_FOR_USER2')">Accept</button>
                    <button type="button" class="btn btn-danger btn-sm btn-rounded" onclick="denyRequest('FRIEND_REQUEST_ID_FOR_USER2')">Deny</button>
                </div>
            </div>
        </div>

        <!-- User 3 Card -->
        <div class="col-xs-12 col-md-3 mb-4">
            <div class="card friend-card">
                <img src="https://via.placeholder.com/150" class="card-img-top" alt="User 3">
                <div class="card-body text-center">
                    <h5 class="card-title">User 3</h5>
                    <p class="card-text">Brief description for User 3.</p>
                    <button type="button" class="btn btn-primary btn-sm btn-rounded" onclick="makeRequest('USER3_ID')">Make a Request</button>
                    <button type="button" class="btn btn-success btn-sm btn-rounded" onclick="acceptRequest('FRIEND_REQUEST_ID_FOR_USER3')">Accept</button>
                    <button type="button" class="btn btn-danger btn-sm btn-rounded" onclick="denyRequest('FRIEND_REQUEST_ID_FOR_USER3')">Deny</button>
                </div>
            </div>
        </div>

        <!-- User 4 Card -->
        <div class="col-xs-12 col-md-3 mb-4">
            <div class="card friend-card">
                <img src="https://via.placeholder.com/150" class="card-img-top" alt="User 4">
                <div class="card-body text-center">
                    <h5 class="card-title">User 4</h5>
                    <p class="card-text">Brief description for User 4.</p>
                    <button type="button" class="btn btn-primary btn-sm btn-rounded" onclick="makeRequest('USER4_ID')">Make a Request</button>
                    <button type="button" class="btn btn-success btn-sm btn-rounded" onclick="acceptRequest('FRIEND_REQUEST_ID_FOR_USER4')">Accept</button>
                    <button type="button" class="btn btn-danger btn-sm btn-rounded" onclick="denyRequest('FRIEND_REQUEST_ID_FOR_USER4')">Deny</button>
                </div>
            </div>
        </div>
    </div>
</div>

        <!-- Bootstrap JS and jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-firestore.js"></script>
<script>
    // Initialize Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyD18a6bP6Ec0QCsLm5bl04prN_WAchA4Is",
        authDomain: "gamtrack-3a2f2.firebaseapp.com",
        projectId: "gamtrack-3a2f2",
        storageBucket: "gamtrack-3a2f2.appspot.com",
        messagingSenderId: "492662811532",
        appId: "1:492662811532:web:4e59f354ffbc43eee384a9",
        measurementId: "G-5VTT1HQLJ1"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();


    function generateFriendshipId() {
        // This will create a new document reference with an auto-generated ID
        const newFriendshipRef = db.collection('Friendship').doc();
        // This is the auto-generated ID you can use
        const friendshipId = newFriendshipRef.id;
        // You can now use this ID to create a new document
        console.log(`Generated friendship ID: ${friendshipId}`);
        return friendshipId;
    }

    // Example of using the generateFriendshipId function within makeRequest
    function makeRequest(receiverUserId) {
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) {
            alert("You must be logged in to make friend requests.");
            return;
        }

        // Generate a new Friendship ID
        const friendshipId = generateFriendshipId();
        const friendRequest = {
            senderId: currentUser.uid,
            receiverId: receiverUserId,
            status: 'requested',
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        // Use the generated friendshipId to set the document
        db.collection('Friendship').doc(friendshipId).set(friendRequest)
            .then(() => {
                console.log(`Friend request successfully sent with ID: ${friendshipId}`);
                alert("Friend request sent.");
            })
            .catch((error) => {
                console.error("Error sending friend request: ", error);
                alert("Failed to send friend request.");
            });
    }

    // Function to handle accepting a friend request
    function acceptRequest(friendshipDocumentId) {
        // Update the document in the 'Friendship' collection
        db.collection('Friendship').doc(friendshipDocumentId).update({
            Status: 'accepted' // Update status to 'accepted'
        })
            .then(() => {
                console.log("Friend request accepted.");
                alert("Friend request accepted.");
            })
            .catch((error) => {
                console.error("Error accepting friend request: ", error);
                alert("Failed to accept friend request.");
            });
    }

    // Function to handle denying a friend request
    function denyRequest(friendshipDocumentId) {
        // Update the document in the 'Friendship' collection
        db.collection('Friendship').doc(friendshipDocumentId).update({
            Status: 'denied' // Update status to 'denied'
        })
            .then(() => {
                console.log("Friend request denied.");
                alert("Friend request denied.");
            })
            .catch((error) => {
                console.error("Error denying friend request: ", error);
                alert("Failed to deny friend request.");
            });
    }
</script>
</body>
</html>